*1;
 FILENAME file1 URL "http://www.uvm.edu/~rsingle/stat231/data/kuehl/ex7_1.txt";
 DATA a1;
 INFILE file1 FIRSTOBS=2 EXPANDTABS;
 INPUT PATIENT RUN CHOLESTEROL;
 RUN;
 PROC GLM DATA=a1;
 CLASS  RUN PATIENT;
 MODEL CHOLESTEROL = RUN PATIENT RUN*PATIENT;
 random RUN PATIENT RUN*PATIENT/test;
 run;
 
*2;
 FILENAME file1 URL "http://www.uvm.edu/~rsingle/stat231/data/kuehl/ex7_2.txt";
 DATA a2;
 INFILE file1 FIRSTOBS=2 EXPANDTABS;
 INPUT SUMMER WATER GAIN;
 RUN;
PROC GLM DATA=a2;
 CLASS   SUMMER WATER;
 MODEL GAIN = SUMMER WATER SUMMER*WATER;
lsmeans SUMMER WATER/CL STDERR;
 run;

*3;
 FILENAME file1 URL "http://www.uvm.edu/~rsingle/stat231/data/kuehl/ex7_3.txt";
 DATA a3;
 INFILE file1 FIRSTOBS=2 EXPANDTABS;
 INPUT ALLOYS CASTINGS STRENGTH;
 S=2-mod(_N_,2);
 RUN;
 PROC GLM DATA=a3;
 CLASS ALLOYS CASTINGS S;
 MODEL STRENGTH = ALLOYS  CASTINGS(ALLOYS) ALLOYS*S(CASTINGS);
 random ALLOYS  CASTINGS(ALLOYS) ALLOYS*S(CASTINGS)/test;
 lsmeans ALLOYS /cl stderr e=CASTINGS(ALLOYS);
 *means ALLOYS  CASTINGS(ALLOYS) ALLOYS*S(CASTINGS)/cldiff cl;
 run;
 
 *4;
FILENAME file1 URL "http://www.uvm.edu/~rsingle/stat231/data/kuehl/ex7_5.txt";
 DATA a4;
 INFILE file1 FIRSTOBS=2 EXPANDTABS;
 INPUT MACHINE PLOT SAMPLE RATIOS;
 run;
 
 PROC GLM DATA=a4;
 CLASS MACHINE PLOT SAMPLE;
 MODEL RATIOS =  MACHINE PLOT SAMPLE(PLOT) MACHINE*PLOT MACHINE*SAMPLE(PLOT)  ;
 random PLOT SAMPLE(PLOT) MACHINE*PLOT MACHINE*SAMPLE(PLOT)/test;
 RUN;